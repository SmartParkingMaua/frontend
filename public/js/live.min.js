"use strict";var Request;!function(){var a="http://localhost:8080/v1/parkings",t=void 0;Request=function(){if(t)return t;var n=function(t,e){var r=new XMLHttpRequest;if(window.XMLHttpRequest)new XMLHttpRequest;else new ActiveXObject("Microsoft.XMLHTTP");r.open("GET",t,!0),r.onreadystatechange=function(){if(4==this.readyState){if(!(200<=this.status&&this.status<400))throw new Error(this.error);e(this.responseText)}},r.onerror=function(){throw new Error(this.error)},r.send()};return(t=this).getParkings=function(e){n(a,function(t){return e(JSON.parse(t))})},this.getDataByHour=function(t,e,r){n(a+"/"+t+"/findByHour?timestamp="+e,function(t){return r(JSON.parse(t))})},this.getDataByDay=function(t,e,r){n(a+"/"+t+"/findByDay?timestamp="+e,function(t){return r(JSON.parse(t))})},this.getDataByWeek=function(t,e,r){n(a+"/"+t+"/findByWeek?timestamp="+e,function(t){return r(JSON.parse(t))})},this.getDataByMonth=function(t,e,r){n(a+"/"+t+"/findByMonth?timestamp="+e,function(t){return r(JSON.parse(t))})},this.getDataByYear=function(t,e,r){n(a+"/"+t+"/findByYear?timestamp="+e,function(t){return r(JSON.parse(t))})},t}}();var Chart=function(i){var o=void 0,u={},c={};return{drawHourChart:function(t){for(var e=[["Minuto","Fluxo"]],r=0;r<t.entrance.length;r++)e.push([t.entrance[r].period,t.entrance[r].value-t.exit[r].value]);u=google.visualization.arrayToDataTable(e),c={colors:["#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},(o=new google.visualization.LineChart(i)).draw(u,c)},drawDayChart:function(t){for(var e=[["Horário do dia","Fluxo"]],r=0;r<t.entrance.length;r++)e.push([t.entrance[r].period,t.entrance[r].value-t.exit[r].value]);u=google.visualization.arrayToDataTable(e),c={colors:["#274d60"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},(o=new google.visualization.LineChart(i)).draw(u,c)},drawAvailabilityChart:function(a){return function(t){var e=t.parkings.find(function(t){return t.id===a}),r=e.lots.occupied,n=e.lots.max-r;u=new google.visualization.arrayToDataTable([["Estado","Número de Carros"],["Disponíveis",n],["Ocupadas",r]]),c={colors:["#274d60","#eda407"],chartArea:{top:"3%",width:"75%",height:"80%"},pieHole:.25,legend:{position:"bottom",textStyle:{fontSize:14,color:"#002536"}}},(o=new google.visualization.PieChart(i)).draw(u,c)}},redrawChart:function(){o.draw(u,c)}}};!function(){var a=new Request,i=Chart(document.querySelector("#live-chart-main")),o=Chart(document.querySelector("#live-chart-availability")),u=document.querySelector("#live-filter-parking"),c=document.querySelectorAll("input[name=live-filter-period]"),r=[],l=void 0;google.charts.load("current",{packages:["corechart"],language:"pt"}),google.charts.setOnLoadCallback(function(){return a.getParkings(t)});var t=function(t){(r=t.parkings).map(function(t){return t.name}).forEach(function(t){var e=document.createElement("option");e.text=t,u.add(e)});var e=(new Date).getTime();if(!s("Dia",0,e))return alert("Período inválido!");l=setInterval(function(){var t=(new Date).getTime();s("Dia",0,t)},3e4),c.forEach(function(t){return t.parentNode.addEventListener("click",n)}),u.addEventListener("change",n),window.onresize=function(){i.redrawChart(),o.redrawChart()}},s=function(t,e,r){var n=!0;switch(t.toUpperCase()){case"HORA":a.getParkings(o.drawAvailabilityChart(e)),a.getDataByHour(e,r,i.drawHourChart),a.getDataByHour(e,r,f);break;case"DIA":a.getParkings(o.drawAvailabilityChart(e)),a.getDataByDay(e,r,i.drawDayChart),a.getDataByDay(e,r,f);break;default:n=!1}return n},n=function(t){var e=void 0;"LABEL"===t.target.tagName?e=t.target.innerText:c.forEach(function(t){t.checked&&(e=t.parentNode.innerText)});var r=d(u.value);if(-1===r)return alert("Estacionamento inválido!");var n=(new Date).getTime();if(!s(e,r,n))return alert("Período inválido!");clearInterval(l),l=setInterval(function(){var t=(new Date).getTime();s(e,r,t)},3e4)},d=function(e){var t=r.find(function(t){return t.name===e});return void 0===t?-1:t.id},f=function(t){var e=document.querySelector("#live-total-entrance"),r=document.querySelector("#live-total-exit"),n=0,a=0;t.entrance.forEach(function(t){return n+=t.value}),t.exit.forEach(function(t){return a+=t.value}),e.innerText=n,r.innerText=a}}();