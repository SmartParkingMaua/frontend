"use strict";var Request;!function(){var t,n="http://localhost:8080/v1/parkings";Request=function(){if(t)return t;var r=function(t,e){var a;(a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).open("GET",t,!0),a.onreadystatechange=function(){if(4==this.readyState){if(!(200<=this.status&&this.status<400))throw new Error(this.error);e(this.responseText)}},a.onerror=function(){throw new Error(this.error)},a.send()};return(t=this).getParkings=function(e){r(n,function(t){return e(JSON.parse(t))})},this.getDataByHour=function(t,e,a){r(n+"/"+t+"/hour?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByDay=function(t,e,a){r(n+"/"+t+"/day?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByWeek=function(t,e,a){r(n+"/"+t+"/week?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByMonth=function(t,e,a){r(n+"/"+t+"/month?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByYear=function(t,e,a){r(n+"/"+t+"/year?timestamp="+e,function(t){return a(JSON.parse(t))})},t}}();var Chart=function(n){var i,o={},u={};return{drawHourChart:function(t){for(var e=t.actions,a=[["Minuto","Fluxo"]],r=0;r<e.entrance.length;r++)a.push([e.entrance[r].period,e.entrance[r].value-e.exit[r].value]);o=google.visualization.arrayToDataTable(a),u={colors:["#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},(i=new google.visualization.LineChart(n)).draw(o,u)},drawDayChart:function(t){for(var e=t.actions,a=[["Horário do dia","Fluxo"]],r=0;r<e.entrance.length;r++)a.push([e.entrance[r].period,e.entrance[r].value-e.exit[r].value]);o=google.visualization.arrayToDataTable(a),u={colors:["#274d60"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},(i=new google.visualization.LineChart(n)).draw(o,u)},drawAvailabilityChart:function(a){return function(t){var e=t.parkings.find(function(t){return t.id===a});o=new google.visualization.arrayToDataTable([["Estado","Número de Carros"],["Disponíveis",e.maxLots-e.occupiedLots],["Ocupadas",e.occupiedLots]]),u={colors:["#274d60","#eda407"],chartArea:{top:"3%",width:"75%",height:"80%"},pieHole:.25,legend:{position:"bottom",textStyle:{fontSize:14,color:"#002536"}}},(i=new google.visualization.PieChart(n)).draw(o,u)}},redrawChart:function(){i.draw(o,u)}}};!function(){var r,n={parking:document.querySelector("#live-filter-parking"),periods:document.querySelectorAll("input[name=live-filter-period]"),mainChart:document.querySelector("#live-chart-main"),availabilityChart:document.querySelector("#live-chart-availability"),totalEntrance:document.querySelector("#live-total-entrance"),totalExit:document.querySelector("#live-total-exit")},a=0,i="Dia",o=3e4,u={main:Chart(n.mainChart),availability:Chart(n.availabilityChart)},c=new Request,l=[];google.charts.load("current",{packages:["corechart"],language:"pt"}),google.charts.setOnLoadCallback(function(){return c.getParkings(t)});var t=function(t){var e=t.parkings;if((l=e).map(function(t){var e=t.name,a=document.createElement("option");a.text=e,n.parking.add(a)}),!s(i,a,(new Date).getTime()))return alert("Período inválido!");r=setInterval(function(){s(i,a,(new Date).getTime())},o),n.parking.addEventListener("change",d),n.periods.forEach(function(t){return t.parentNode.addEventListener("click",d)}),window.onresize=function(){u.main.redrawChart(),u.availability.redrawChart()}},s=function(t,e,a){var r=!0;switch(t.toUpperCase()){case"HORA":c.getParkings(u.availability.drawAvailabilityChart(e)),c.getDataByHour(e,a,u.main.drawHourChart),c.getDataByHour(e,a,f);break;case"DIA":c.getParkings(u.availability.drawAvailabilityChart(e)),c.getDataByDay(e,a,u.main.drawDayChart),c.getDataByDay(e,a,f);break;default:r=!1}return r},d=function(t){var e,a=h(n.parking.value);return"LABEL"===t.target.tagName?e=t.target.innerText:n.periods.forEach(function(t){t.checked&&(e=t.parentNode.innerText)}),-1===a?alert("Estacionamento inválido!"):s(e,a,(new Date).getTime())?(clearInterval(r),void(r=setInterval(function(){s(e,a,(new Date).getTime())},o))):alert("Período inválido!")},h=function(e){var t=l.find(function(t){return t.name===e});return void 0===t?-1:t.id},f=function(t){var e=t.actions,a=e.entrance.reduce(function(t,e){return t+e.value},0),r=e.exit.reduce(function(t,e){return t+e.value},0);n.totalEntrance.innerText=a,n.totalExit.innerText=r}}();