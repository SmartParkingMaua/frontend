"use strict";var Request;!function(){var t,i="http://localhost:8080/v1/parkings";Request=function(){if(t)return t;var r=function(t,e){var a;(a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).open("GET",t,!0),a.onreadystatechange=function(){if(4==this.readyState){if(!(200<=this.status&&this.status<400))throw new Error(this.error);e(this.responseText)}},a.onerror=function(){throw new Error(this.error)},a.send()};return(t=this).getParkings=function(e){r(i,function(t){return e(JSON.parse(t))})},this.getDataByHour=function(t,e,a){r(i+"/"+t+"/hour?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByDay=function(t,e,a){r(i+"/"+t+"/day?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByWeek=function(t,e,a){r(i+"/"+t+"/week?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByMonth=function(t,e,a){r(i+"/"+t+"/month?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByYear=function(t,e,a){r(i+"/"+t+"/year?timestamp="+e,function(t){return a(JSON.parse(t))})},t}}();var Chart=function(u){var s,d={},f={},m=function(r,i){google.visualization.events.addListener(s,"select",function(){var t=s.getSelection();if(t.length&&!t[0].row){var e,a=t[0].column;r[a]==a?(r[a]={label:d.getColumnLabel(a),type:d.getColumnType(a),calc:function(){return null}},i[a-1].color="#cccccc"):(r[a]=a,i[a-1].color=null),(e=new google.visualization.DataView(d)).setColumns(r),s.draw(e,f)}})};return{drawHourChart:function(t){for(var e=t.actions,a=t.timestamp,r=new Date(a.from).toLocaleTimeString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),i=[],n={0:{},1:{},2:{type:"line"}},o=[["Minuto","Entrada","Saída","Fluxo"]],c=0;c<e.entrance.length;c++)o.push([e.entrance[c].period,e.entrance[c].value,e.exit[c].value,e.entrance[c].value-e.exit[c].value]);d=google.visualization.arrayToDataTable(o);for(var l=0;l<d.getNumberOfColumns();l++)i.push(l);f={title:"Hora - ".concat(r.replace(/:/,"h")),titleTextStyle:{fontSize:18,color:"#002536"},seriesType:"bars",tooltip:{trigger:"selection"},aggregationTarget:"category",series:n,colors:["#54798d","#ffd54b","#002536"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},(s=new google.visualization.ComboChart(u)).draw(d,f),m(i,n)},drawDayChart:function(t){for(var e=t.actions,a=t.timestamp,r=new Date(a.from).toLocaleDateString("pt-BR"),i=[],n={0:{},1:{},2:{type:"line"}},o=[["Hora","Entrada","Saída","Fluxo"]],c=0;c<e.entrance.length;c++)o.push([e.entrance[c].period,e.entrance[c].value,e.exit[c].value,e.entrance[c].value-e.exit[c].value]);d=google.visualization.arrayToDataTable(o);for(var l=0;l<d.getNumberOfColumns();l++)i.push(l);f={title:"Dia - ".concat(r),titleTextStyle:{fontSize:18,color:"#002536"},seriesType:"bars",tooltip:{trigger:"selection"},aggregationTarget:"category",series:n,colors:["#54798d","#ffd54b","#002536"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},(s=new google.visualization.ComboChart(u)).draw(d,f),m(i,n)},drawWeekChart:function(t){var e=t.actions,a=t.timestamp,r=new Date(a.from).toLocaleDateString("pt-BR"),i=new Date(a.to).toLocaleDateString("pt-BR"),n=[["Dias da semana","Entrada"]];e.entrance.forEach(function(t){return n.push([t.period,t.value])}),d=google.visualization.arrayToDataTable(n),f={title:"Semana - ".concat(r," à ").concat(i),titleTextStyle:{fontSize:18,color:"#002536"},colors:["#274d60"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{minValue:0,format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"}},(s=new google.visualization.ColumnChart(u)).draw(d,f)},drawMonthChart:function(t){var e=t.actions,a=t.timestamp,r=new Date(a.from).toLocaleDateString("pt-BR"),i=new Date(a.to).toLocaleDateString("pt-BR"),n=[["Dias do mês","Entrada"]];e.entrance.forEach(function(t){return n.push([t.period,t.value])}),d=google.visualization.arrayToDataTable(n),f={title:"Mês - ".concat(r," à ").concat(i),titleTextStyle:{fontSize:18,color:"#002536"},colors:["#274d60"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{minValue:0,format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"}},(s=new google.visualization.ColumnChart(u)).draw(d,f)},drawYearChart:function(t){var e=t.actions,a=t.timestamp,r=new Date(a.from).toLocaleDateString("pt-BR",{month:"2-digit",year:"numeric"}),i=new Date(a.to).toLocaleDateString("pt-BR",{month:"2-digit",year:"numeric"}),n=[["Meses do ano","Entrada"]];e.entrance.forEach(function(t){return n.push([t.period,t.value])}),d=google.visualization.arrayToDataTable(n),f={title:"Ano - ".concat(r," à ").concat(i),titleTextStyle:{fontSize:18,color:"#002536"},colors:["#274d60"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},(s=new google.visualization.LineChart(u)).draw(d,f)},redrawChart:function(){s.draw(d,f)}}};function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),r.forEach(function(t){_defineProperty(e,t,a[t])})}return e}function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}!function(){var e={language:"pt-br",startDate:new Date("2018-01-01 00:00:00.000"),endDate:new Date};$("#hist-filter-datetime").fdatepicker(_objectSpread({},e,{format:"dd/mm/yyyy",pickTime:!1,initialDate:new Date,startView:"month",minView:"month"})),$("#hist-filter-datetime-icon").click(function(){$("#hist-filter-datetime").fdatepicker("show")}),$("#hist-filter-period").change(function(){var t=$("#hist-filter-period")[0].value;$("#hist-filter-datetime").fdatepicker("remove"),"Hora"===t?$("#hist-filter-datetime").fdatepicker(_objectSpread({},e,{format:"dd/mm/yyyy hh:ii",pickTime:!0,initialDate:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),(new Date).getHours()),startView:"day",minView:"day"})):"Ano"===t?$("#hist-filter-datetime").fdatepicker(_objectSpread({},e,{format:"mm/yyyy",pickTime:!1,initialDate:new Date,startView:"year",minView:"year"})):$("#hist-filter-datetime").fdatepicker(_objectSpread({},e,{format:"dd/mm/yyyy",pickTime:!1,initialDate:new Date,startView:"month",minView:"month"}))})}(),function(){var r={parking:document.querySelector("#hist-filter-parking"),period:document.querySelector("#hist-filter-period"),datetime:document.querySelector("#hist-filter-datetime"),mainChart:document.querySelector("#hist-chart-main"),filterTrigger:document.querySelector("#hist-filter-trigger")},a=0,i="Dia",n={main:Chart(r.mainChart)},o=new Request,c=[];google.charts.load("current",{packages:["corechart"],language:"pt"}),google.charts.setOnLoadCallback(function(){return o.getParkings(t)});var t=function(t){var e=t.parkings;if((c=e).map(function(t){var e=t.name,a=document.createElement("option");a.text=e,r.parking.add(a)}),!l(i,a,(new Date).getTime()))return alert("Período inválido!");r.filterTrigger.addEventListener("click",u),window.onresize=function(){n.main.redrawChart()}},l=function(t,e,a){var r=!0;switch(t.toUpperCase()){case"HORA":o.getDataByHour(e,a,n.main.drawHourChart);break;case"DIA":o.getDataByDay(e,a,n.main.drawDayChart);break;case"SEMANA":o.getDataByWeek(e,a,n.main.drawWeekChart);break;case"MÊS":o.getDataByMonth(e,a,n.main.drawMonthChart);break;case"ANO":o.getDataByYear(e,a,n.main.drawYearChart);break;default:r=!1}return r},u=function(t){var e=s(r.parking.value),a=d(r.datetime.value);return-1===e?alert("Estacionamento inválido!"):f(a)?l(r.period.value,e,new Date(a).getTime())?void $("#hist-filter-modal").modal("hide"):alert("Período inválido!"):alert("Data inválida!")},s=function(e){var t=c.find(function(t){return t.name===e});return void 0===t?-1:t.id},d=function(t){var e=t.split(/\ /),a=e[0].split(/\//),r=e[1]?e[1]:"00:00";return 2===a.length&&a.unshift("01"),a[2]+"-"+a[1]+"-"+a[0]+" "+r},f=function(t){var e=new Date(t);return!!t.match(/^\d{4}-\d{2}-\d{2}\ \d{2}:\d{2}$/)&&!Number.isNaN(e.getTime())}}();