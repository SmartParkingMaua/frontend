"use strict";var Request;!function(){var i="http://localhost:8080/v1/parkings",t=void 0;Request=function(){if(t)return t;var r=function(t,e){var a=new XMLHttpRequest;if(window.XMLHttpRequest)new XMLHttpRequest;else new ActiveXObject("Microsoft.XMLHTTP");a.open("GET",t,!0),a.onreadystatechange=function(){if(4==this.readyState){if(!(200<=this.status&&this.status<400))throw new Error(this.error);e(this.responseText)}},a.onerror=function(){throw new Error(this.error)},a.send()};return(t=this).getParkings=function(e){r(i,function(t){return e(JSON.parse(t))})},this.getDataByHour=function(t,e,a){r(i+"/"+t+"/findByHour?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByDay=function(t,e,a){r(i+"/"+t+"/findByDay?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByWeek=function(t,e,a){r(i+"/"+t+"/findByWeek?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByMonth=function(t,e,a){r(i+"/"+t+"/findByMonth?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByYear=function(t,e,a){r(i+"/"+t+"/findByYear?timestamp="+e,function(t){return a(JSON.parse(t))})},t}}();var Chart=function(n){var o=void 0,l={},c={},u=[],s={},d=function(){google.visualization.events.addListener(o,"select",function(){var t=o.getSelection();if(0<t.length&&null===t[0].row){var e=t[0].column;u[e]==e?(u[e]={label:l.getColumnLabel(e),type:l.getColumnType(e),calc:function(){return null}},s[e-1].color="#cccccc"):(u[e]=e,s[e-1].color=null);var a=new google.visualization.DataView(l);a.setColumns(u),o.draw(a,c)}})};return{drawHourChart:function(t){for(var e=[["Minuto","Entrada","Saída","Fluxo"]],a=0;a<t.entrance.length;a++)e.push([t.entrance[a].period,t.entrance[a].value,t.exit[a].value,t.entrance[a].value-t.exit[a].value]);l=google.visualization.arrayToDataTable(e),s={0:{},1:{},2:{type:"line"}},u=[];for(var r=0;r<l.getNumberOfColumns();r++)u.push(r);var i=new Date(t.timestampFrom).toLocaleTimeString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});c={title:"Hora - "+i.replace(/:/,"h"),titleTextStyle:{fontSize:18,color:"#002536"},seriesType:"bars",tooltip:{trigger:"selection"},aggregationTarget:"category",series:s,colors:["#54798d","#ffd54b","#002536"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},(o=new google.visualization.ComboChart(n)).draw(l,c),d()},drawDayChart:function(t){for(var e=[["Horário do dia","Entrada","Saída","Fluxo"]],a=0;a<t.entrance.length;a++)e.push([t.entrance[a].period,t.entrance[a].value,t.exit[a].value,t.entrance[a].value-t.exit[a].value]);l=google.visualization.arrayToDataTable(e),s={0:{},1:{},2:{type:"line"}},u=[];for(var r=0;r<l.getNumberOfColumns();r++)u.push(r);var i=new Date(t.timestampFrom).toLocaleDateString("pt-BR");c={title:"Dia - "+i,titleTextStyle:{fontSize:18,color:"#002536"},seriesType:"bars",tooltip:{trigger:"selection"},aggregationTarget:"category",series:s,colors:["#54798d","#ffd54b","#002536"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},(o=new google.visualization.ComboChart(n)).draw(l,c),d()},drawWeekChart:function(t){var e=[["Dias da semana","Entrada"]];t.entrance.forEach(function(t){return e.push([t.period,t.value])}),l=google.visualization.arrayToDataTable(e);var a=new Date(t.timestampFrom).toLocaleDateString("pt-BR"),r=new Date(t.timestampTo).toLocaleDateString("pt-BR");c={title:"Semana - "+a+" à "+r,titleTextStyle:{fontSize:18,color:"#002536"},colors:["#274d60"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{minValue:0,format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"}},(o=new google.visualization.ColumnChart(n)).draw(l,c)},drawMonthChart:function(t){var e=[["Dias do mês","Entrada"]];t.entrance.forEach(function(t){return e.push([t.period,t.value])}),l=google.visualization.arrayToDataTable(e);var a=new Date(t.timestampFrom).toLocaleDateString("pt-BR"),r=new Date(t.timestampTo).toLocaleDateString("pt-BR");c={title:"Mês - "+a+" à "+r,titleTextStyle:{fontSize:18,color:"#002536"},colors:["#274d60"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{minValue:0,format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"}},(o=new google.visualization.ColumnChart(n)).draw(l,c)},drawYearChart:function(t){var e=[["Meses do ano","Entrada"]];t.entrance.forEach(function(t){return e.push([t.period,t.value])}),l=google.visualization.arrayToDataTable(e);var a=new Date(t.timestampFrom).toLocaleDateString("pt-BR",{month:"2-digit",year:"numeric"}),r=new Date(t.timestampTo).toLocaleDateString("pt-BR",{month:"2-digit",year:"numeric"});c={title:"Ano - "+a+" à "+r,titleTextStyle:{fontSize:18,color:"#002536"},colors:["#274d60"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},(o=new google.visualization.LineChart(n)).draw(l,c)},redrawChart:function(){o.draw(l,c)}}};$("#hist-filter-datetime").fdatepicker({format:"dd/mm/yyyy",language:"pt-br",pickTime:!1,initialDate:new Date,startView:"month",minView:"month"}),$("#hist-filter-datetime-icon").click(function(){$("#hist-filter-datetime").fdatepicker("show")}),$("#hist-filter-period").change(function(){var t=document.querySelector("#hist-filter-period").value;$("#hist-filter-datetime").fdatepicker("remove"),"Hora"===t?$("#hist-filter-datetime").fdatepicker({format:"dd/mm/yyyy hh:ii",language:"pt-br",pickTime:!0,initialDate:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),startView:"day",minView:"day"}):"Ano"===t?$("#hist-filter-datetime").fdatepicker({format:"mm/yyyy",language:"pt-br",pickTime:!1,initialDate:new Date,startView:"year",minView:"year"}):$("#hist-filter-datetime").fdatepicker({format:"dd/mm/yyyy",language:"pt-br",pickTime:!1,initialDate:new Date,startView:"month",minView:"month"})}),function(){var i=new Request,n=Chart(document.querySelector("#hist-chart-main")),o=document.querySelector("#hist-filter-parking"),l=document.querySelector("#hist-filter-period"),c=document.querySelector("#hist-filter-datetime"),a=[];google.charts.load("current",{packages:["corechart"],language:"pt"}),google.charts.setOnLoadCallback(function(){return i.getParkings(t)});var t=function(t){(a=t.parkings).map(function(t){return t.name}).forEach(function(t){var e=document.createElement("option");e.text=t,o.add(e)});var e=(new Date).getTime();if(!u("Dia",0,e))return alert("Período inválido!");document.querySelector("#hist-filter-trigger").addEventListener("click",r),window.onresize=function(){n.redrawChart()}},u=function(t,e,a){var r=!0;switch(t.toUpperCase()){case"HORA":i.getDataByHour(e,a,n.drawHourChart);break;case"DIA":i.getDataByDay(e,a,n.drawDayChart);break;case"SEMANA":i.getDataByWeek(e,a,n.drawWeekChart);break;case"MÊS":i.getDataByMonth(e,a,n.drawMonthChart);break;case"ANO":i.getDataByYear(e,a,n.drawYearChart);break;default:r=!1}return r},r=function(t){var e=s(o.value);if(-1===e)return alert("Estacionamento inválido!");var a=d(c.value);if(!f(a))return alert("Data inválida!");var r=new Date(a).getTime();if(!u(l.value,e,r))return alert("Período inválido!");$("#hist-filter-modal").modal("hide")},s=function(e){var t=a.find(function(t){return t.name===e});return void 0===t?-1:t.id},d=function(t){var e=t.split(/\ /),a=e[0].split(/\//);2===a.length&&a.unshift("01");var r=void 0!==e[1]?e[1]:"";return a[2]+"-"+a[1]+"-"+a[0]+" "+r},f=function(t){if(!t.match(/^\d{4}-\d{2}-\d{2}\ (\d{2}:\d{2})?$/))return!1;var e=new Date(t);return!Number.isNaN(e.getTime())}}();