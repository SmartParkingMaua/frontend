"use strict";var Request;!function(){var t,r="http://localhost:8080/v1/parkings";Request=function(){if(t)return t;var i=function(t,e){var a;(a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).open("GET",t,!0),a.onreadystatechange=function(){if(4==this.readyState){if(!(200<=this.status&&this.status<400))throw new Error(this.error);e(this.responseText)}},a.onerror=function(){throw new Error(this.error)},a.send()};return(t=this).getParkings=function(e){i(r,function(t){return e(JSON.parse(t))})},this.getDataByHour=function(t,e,a){i(r+"/"+t+"/hour?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByDay=function(t,e,a){i(r+"/"+t+"/day?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByWeek=function(t,e,a){i(r+"/"+t+"/week?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByMonth=function(t,e,a){i(r+"/"+t+"/month?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByYear=function(t,e,a){i(r+"/"+t+"/year?timestamp="+e,function(t){return a(JSON.parse(t))})},t}}();var Chart=function(u){var s,d={},m={},g=function(i,r){google.visualization.events.addListener(s,"select",function(){var t=s.getSelection();if(t.length&&!t[0].row){var e,a=t[0].column;i[a]==a?(i[a]={label:d.getColumnLabel(a),type:d.getColumnType(a),calc:function(){return null}},r[a-1].color="#cccccc"):(i[a]=a,r[a-1].color=null),(e=new google.visualization.DataView(d)).setColumns(i),s.draw(e,m)}})};return{drawHourChart:function(t){for(var e=t.actions,a=t.timestamp,i=new Date(a.from).toLocaleTimeString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),r=[],n={0:{},1:{},2:{type:"line"}},o=[["Minuto","Entrada","Saída","Fluxo"]],l=0;l<e.entrance.length;l++)o.push([e.entrance[l].period,e.entrance[l].value,e.exit[l].value,e.entrance[l].value-e.exit[l].value]);d=google.visualization.arrayToDataTable(o);for(var c=0;c<d.getNumberOfColumns();c++)r.push(c);m={title:"Hora - ".concat(i.replace(/:/,"h")),titleTextStyle:{fontSize:18,color:"#002536"},seriesType:"bars",tooltip:{trigger:"selection"},aggregationTarget:"category",series:n,colors:["#54798d","#ffd54b","#002536"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},(s=new google.visualization.ComboChart(u)).draw(d,m),g(r,n)},drawDayChart:function(t){for(var e=t.actions,a=t.timestamp,i=new Date(a.from).toLocaleDateString("pt-BR"),r=[],n={0:{},1:{},2:{type:"line"}},o=[["Hora","Entrada","Saída","Fluxo"]],l=0;l<e.entrance.length;l++)o.push([e.entrance[l].period,e.entrance[l].value,e.exit[l].value,e.entrance[l].value-e.exit[l].value]);d=google.visualization.arrayToDataTable(o);for(var c=0;c<d.getNumberOfColumns();c++)r.push(c);m={title:"Dia - ".concat(i),titleTextStyle:{fontSize:18,color:"#002536"},seriesType:"bars",tooltip:{trigger:"selection"},aggregationTarget:"category",series:n,colors:["#54798d","#ffd54b","#002536"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},(s=new google.visualization.ComboChart(u)).draw(d,m),g(r,n)},drawWeekChart:function(t){var e=t.actions,a=t.timestamp,i=new Date(a.from).toLocaleDateString("pt-BR"),r=new Date(a.to).toLocaleDateString("pt-BR"),n=[["Dias da semana","Entrada"]];e.entrance.forEach(function(t){return n.push([t.period,t.value])}),d=google.visualization.arrayToDataTable(n),m={title:"Semana - ".concat(i," à ").concat(r),titleTextStyle:{fontSize:18,color:"#002536"},colors:["#274d60"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{minValue:0,format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"}},(s=new google.visualization.ColumnChart(u)).draw(d,m)},drawMonthChart:function(t){var e=t.actions,a=t.timestamp,i=new Date(a.from).toLocaleDateString("pt-BR"),r=new Date(a.to).toLocaleDateString("pt-BR"),n=[["Dias do mês","Entrada"]];e.entrance.forEach(function(t){return n.push([t.period,t.value])}),d=google.visualization.arrayToDataTable(n),m={title:"Mês - ".concat(i," à ").concat(r),titleTextStyle:{fontSize:18,color:"#002536"},colors:["#274d60"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{minValue:0,format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"}},(s=new google.visualization.ColumnChart(u)).draw(d,m)},drawYearChart:function(t){var e=t.actions,a=t.timestamp,i=new Date(a.from).toLocaleDateString("pt-BR",{month:"2-digit",year:"numeric"}),r=new Date(a.to).toLocaleDateString("pt-BR",{month:"2-digit",year:"numeric"}),n=[["Meses do ano","Entrada"]];e.entrance.forEach(function(t){return n.push([t.period,t.value])}),d=google.visualization.arrayToDataTable(n),m={title:"Ano - ".concat(i," à ").concat(r),titleTextStyle:{fontSize:18,color:"#002536"},colors:["#274d60"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#002536"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#002536"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},(s=new google.visualization.LineChart(u)).draw(d,m)},redrawChart:function(){s.draw(d,m)}}};$("#hist-filter-datetime").fdatepicker({format:"dd/mm/yyyy",language:"pt-br",pickTime:!1,initialDate:new Date,startView:"month",minView:"month",startDate:new Date("2018-01-01 00:00:00.000"),endDate:new Date}),$("#hist-filter-datetime-icon").click(function(){$("#hist-filter-datetime").fdatepicker("show")}),$("#hist-filter-period").change(function(){var t=$("#hist-filter-period")[0].value;$("#hist-filter-datetime").fdatepicker("remove"),"Hora"===t?$("#hist-filter-datetime").fdatepicker({format:"dd/mm/yyyy hh:ii",language:"pt-br",pickTime:!0,initialDate:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),(new Date).getHours()),startView:"day",minView:"day",startDate:new Date("2018-01-01 00:00:00.000"),endDate:new Date}):"Ano"===t?$("#hist-filter-datetime").fdatepicker({format:"mm/yyyy",language:"pt-br",pickTime:!1,initialDate:new Date,startView:"year",minView:"year",startDate:new Date("2018-01-01 00:00:00.000"),endDate:new Date}):$("#hist-filter-datetime").fdatepicker({format:"dd/mm/yyyy",language:"pt-br",pickTime:!1,initialDate:new Date,startView:"month",minView:"month",startDate:new Date("2018-01-01 00:00:00.000"),endDate:new Date})}),function(){var i={parking:document.querySelector("#hist-filter-parking"),period:document.querySelector("#hist-filter-period"),datetime:document.querySelector("#hist-filter-datetime"),mainChart:document.querySelector("#hist-chart-main"),filterTrigger:document.querySelector("#hist-filter-trigger")},a=0,r="Dia",n={main:Chart(i.mainChart)},o=new Request,l=[];google.charts.load("current",{packages:["corechart"],language:"pt"}),google.charts.setOnLoadCallback(function(){return o.getParkings(t)});var t=function(t){var e=t.parkings;if((l=e).map(function(t){var e=t.name,a=document.createElement("option");a.text=e,i.parking.add(a)}),!c(r,a,(new Date).getTime()))return alert("Período inválido!");i.filterTrigger.addEventListener("click",u),window.onresize=function(){n.main.redrawChart()}},c=function(t,e,a){var i=!0;switch(t.toUpperCase()){case"HORA":o.getDataByHour(e,a,n.main.drawHourChart);break;case"DIA":o.getDataByDay(e,a,n.main.drawDayChart);break;case"SEMANA":o.getDataByWeek(e,a,n.main.drawWeekChart);break;case"MÊS":o.getDataByMonth(e,a,n.main.drawMonthChart);break;case"ANO":o.getDataByYear(e,a,n.main.drawYearChart);break;default:i=!1}return i},u=function(t){var e=s(i.parking.value),a=d(i.datetime.value);return-1===e?alert("Estacionamento inválido!"):m(a)?c(i.period.value,e,new Date(a).getTime())?void $("#hist-filter-modal").modal("hide"):alert("Período inválido!"):alert("Data inválida!")},s=function(e){var t=l.find(function(t){return t.name===e});return void 0===t?-1:t.id},d=function(t){var e=t.split(/\ /),a=e[0].split(/\//),i=e[1]?e[1]:"00:00";return 2===a.length&&a.unshift("01"),a[2]+"-"+a[1]+"-"+a[0]+" "+i},m=function(t){var e=new Date(t);return!!t.match(/^\d{4}-\d{2}-\d{2}\ \d{2}:\d{2}$/)&&!Number.isNaN(e.getTime())}}();