"use strict";var SPMRequest;!function(){var n="http://localhost:8080/v1/parkings",t=void 0;SPMRequest=function(){if(t)return t;function r(t,e){var a=new XMLHttpRequest;if(window.XMLHttpRequest)new XMLHttpRequest;else new ActiveXObject("Microsoft.XMLHTTP");a.open("GET",t,!0),a.onreadystatechange=function(){if(4==this.readyState){if(!(200<=this.status&&this.status<400))throw new Error(this.error);e(this.responseText)}},a.onerror=function(){throw new Error(this.error)},a.send()}return(t=this).getParkings=function(e){r(n,function(t){return e(JSON.parse(t))})},this.getDataByHour=function(t,e,a){r(n+"/"+t+"/findByHour?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByDay=function(t,e,a){r(n+"/"+t+"/findByDay?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByWeek=function(t,e,a){r(n+"/"+t+"/findByWeek?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByMonth=function(t,e,a){r(n+"/"+t+"/findByMonth?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByYear=function(t,e,a){r(n+"/"+t+"/findByYear?timestamp="+e,function(t){return a(JSON.parse(t))})},t}}();var chart=function(i){var o=void 0,u={},c={};return{drawHourChart:function(t){for(var e=[["Minuto","Fluxo"]],a=0;a<t.entrance.length;a++)e.push([t.entrance[a].period,t.entrance[a].value-t.exit[a].value]);u=google.visualization.arrayToDataTable(e),c={colors:["#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},o=new google.visualization.LineChart(i),o.draw(u,c)},drawDayChart:function(t){for(var e=[["Horário do dia","Fluxo"]],a=0;a<t.entrance.length;a++)e.push([t.entrance[a].period,t.entrance[a].value-t.exit[a].value]);u=google.visualization.arrayToDataTable(e),c={colors:["#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},o=new google.visualization.LineChart(i),o.draw(u,c)},drawAvailabilityChart:function(n){return function(t){var e=t.parkings.find(function(t){return t.id===n}),a=e.lots.occupied,r=e.lots.max-a;u=new google.visualization.arrayToDataTable([["Estado","Número de Carros"],["Disponíveis",r],["Ocupadas",a]]),c={colors:["#004684","#eda407"],chartArea:{top:"3%",width:"75%",height:"80%"},pieHole:.25,legend:{position:"bottom",textStyle:{fontSize:14,color:"#053061"}}},o=new google.visualization.PieChart(i),o.draw(u,c)}},redrawChart:function(){o.draw(u,c)}}};!function(){var o=3e4,n=new SPMRequest,i=chart(document.querySelector("#aovivo-chart-main")),u=chart(document.querySelector("#aovivo-chart-availability")),c=document.querySelector("#aovivo-filter-parking"),l=document.querySelectorAll("input[name=aovivo-filter-period]"),s=[],f=void 0;function t(t){if((s=t.parkings).map(function(t){return t.name}).forEach(function(t){var e=document.createElement("option");e.text=t,c.add(e)}),!d("Dia",0,(new Date).getTime()))return alert("Período inválido!");f=setInterval(function(){d("Dia",0,(new Date).getTime())},o),l.forEach(function(t){return t.parentNode.addEventListener("click",e)}),c.addEventListener("change",e),window.onresize=function(){i.redrawChart(),u.redrawChart()}}function d(t,e,a){var r=!0;switch(t.toUpperCase()){case"HORA":n.getParkings(u.drawAvailabilityChart(e)),n.getDataByHour(e,a,i.drawHourChart),n.getDataByHour(e,a,h);break;case"DIA":n.getParkings(u.drawAvailabilityChart(e)),n.getDataByDay(e,a,i.drawDayChart),n.getDataByDay(e,a,h);break;default:r=!1}return r}function e(t){var e=void 0;"LABEL"===t.target.tagName?e=t.target.innerText:l.forEach(function(t){t.checked&&(e=t.parentNode.innerText)});var a,r,n=(a=c.value,void 0===(r=s.find(function(t){return t.name===a}))?-1:r.id);if(-1===n)return alert("Estacionamento inválido!");var i=(new Date).getTime();if(!d(e,n,i))return alert("Período inválido!");clearInterval(f),f=setInterval(function(){var t=(new Date).getTime();d(e,n,t)},o)}function h(t){var e=document.querySelector("#aovivo-total-entrance"),a=document.querySelector("#aovivo-total-exit"),r=0,n=0;t.entrance.forEach(function(t){return r+=t.value}),t.exit.forEach(function(t){return n+=t.value}),e.innerText=r,a.innerText=n}google.charts.load("current",{packages:["corechart"],language:"pt"}),google.charts.setOnLoadCallback(function(){return n.getParkings(t)})}();