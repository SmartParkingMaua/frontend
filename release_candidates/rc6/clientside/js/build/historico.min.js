"use strict";var SPMRequest;jQuery.datetimepicker.setLocale("pt"),jQuery("#hist-filter-datetime").datetimepicker({value:new Date,format:"d/m/Y H:00",closeOnDateSelect:!0,mask:!0,id:"hist-filter-calendar",onGenerate:function(){if(window.innerWidth<992){var t=document.querySelector("#hist-filter-calendar");t.style.left=window.innerWidth/2-t.offsetWidth/2+"px",t.style.top=window.innerHeight/2-t.offsetHeight/2+"px",t.style.bottom=""}}}),jQuery("#hist-filter-datetime-icon").click(function(){jQuery("#hist-filter-datetime").datetimepicker("show")}),function(){var n="http://localhost:8080/v1/estacionamentos/",t=void 0;SPMRequest=function(){if(t)return t;function r(t,e){var a=new XMLHttpRequest;if(window.XMLHttpRequest)new XMLHttpRequest;else new ActiveXObject("Microsoft.XMLHTTP");a.open("GET",t,!0),a.onreadystatechange=function(){if(4==this.readyState){if(!(200<=this.status&&this.status<400))throw new Error(this.error);e(this.responseText)}},a.onerror=function(){throw new Error(this.error)},a.send()}return(t=this).getParkings=function(e){r(n,function(t){return e(JSON.parse(t))})},this.getDataByHour=function(t,e,a){r(n+t+"/findByHour?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByDay=function(t,e,a){r(n+t+"/findByDay?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByWeek=function(t,e,a){r(n+t+"/findByWeek?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByMonth=function(t,e,a){r(n+t+"/findByMonth?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByYear=function(t,e,a){r(n+t+"/findByYear?timestamp="+e,function(t){return a(JSON.parse(t))})},t}}();var chart=function(s){var d=void 0,f={},h={},i=[],l={},c=function(){google.visualization.events.addListener(d,"select",function(){var t=d.getSelection();if(0<t.length&&null===t[0].row){var e=t[0].column;i[e]==e?(i[e]={label:f.getColumnLabel(e),type:f.getColumnType(e),calc:function(){return null}},l[e-1].color="#cccccc"):(i[e]=e,l[e-1].color=null);var a=new google.visualization.DataView(f);a.setColumns(i),d.draw(a,h)}})};return{drawHourChart:function(o){return function(t){for(var e=[["Minuto","Entrada","Saída","Fluxo"]],a=0;a<t.entrada.length;a++)e.push([5*(a+1)+"m",t.entrada[a],t.saida[a],Math.floor(Math.random()*t.entrada[a])-Math.floor(Math.random()*t.saida[a])]);f=google.visualization.arrayToDataTable(e),l={0:{},1:{},2:{type:"line"}},i=[];for(var r=0;r<f.getNumberOfColumns();r++)i.push(r);var n=new Date(o).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});h={title:"Hora - "+n.replace(/:/,"h"),titleTextStyle:{fontSize:16,color:"#053061"},seriesType:"bars",tooltip:{trigger:"selection"},aggregationTarget:"category",series:l,colors:["#a7cfff","#fcde9c","#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},d=new google.visualization.ComboChart(s),d.draw(f,h),c()}},drawDayChart:function(o){return function(t){for(var e=[["Horário do dia","Entrada","Saída","Fluxo"]],a=0;a<t.entrada.length;a++)e.push([a+1+"h",t.entrada[a],t.saida[a],Math.floor(Math.random()*t.entrada[a])-Math.floor(Math.random()*t.saida[a])]);f=google.visualization.arrayToDataTable(e),l={0:{},1:{},2:{type:"line"}},i=[];for(var r=0;r<f.getNumberOfColumns();r++)i.push(r);var n=new Date(o).toLocaleDateString("pt-BR");h={title:"Dia - "+n,titleTextStyle:{fontSize:16,color:"#053061"},seriesType:"bars",tooltip:{trigger:"selection"},aggregationTarget:"category",series:l,colors:["#a7cfff","#fcde9c","#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},d=new google.visualization.ComboChart(s),d.draw(f,h),c()}},drawWeekChart:function(l){return function(t){var e=[["Dias da semana","Entrada"]],a=void 0,r=l;for(var n in t)a=new Date(r).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}),e.push([a,t[n].entrada.reduce(function(t,e){return t+e})]),r+=864e5;f=google.visualization.arrayToDataTable(e);var o=new Date(l).toLocaleDateString("pt-BR"),i=new Date(l+5184e5).toLocaleDateString("pt-BR");h={title:"Semana - "+o+" à "+i,titleTextStyle:{fontSize:16,color:"#053061"},colors:["#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{minValue:0,format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"}},d=new google.visualization.ColumnChart(s),d.draw(f,h)}},drawMonthChart:function(u){return function(t){var e=[["Dias do mês","Entrada"]],a=0,r=void 0,n=u;for(var o in t)for(var i in t[o])a%7==0?(r=new Date(n).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}),e.push([r,t[o][i].entrada.reduce(function(t,e){return t+e})]),n+=6048e5):e.push([i.slice(0,1).toUpperCase(),t[o][i].entrada.reduce(function(t,e){return t+e})]),a++;f=google.visualization.arrayToDataTable(e);var l=new Date(u).toLocaleDateString("pt-BR"),c=new Date(u+2592e6).toLocaleDateString("pt-BR");h={title:"Mês - "+l+" à "+c,titleTextStyle:{fontSize:16,color:"#053061"},colors:["#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{minValue:0,format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"}},d=new google.visualization.ColumnChart(s),d.draw(f,h)}},drawYearChart:function(r){return function(t){f=new google.visualization.arrayToDataTable([["Meses do ano","Entrada"],["Jan",3e3],["Fev",3200],["Mar",2900],["Abr",3100],["Mai",2800],["Jun",1500],["Jul",500],["Ago",1500],["Set",1500],["Out",1500],["Nov",1500],["Dez",1500]]);var e=new Date(r).toLocaleDateString("pt-BR"),a=new Date(r+31536e6).toLocaleDateString("pt-BR");h={title:"Ano - "+e+" à "+a,titleTextStyle:{fontSize:16,color:"#053061"},colors:["#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},d=new google.visualization.LineChart(s),d.draw(f,h)}},redrawChart:function(){d.draw(f,h)}}};!function(){var n=new SPMRequest,o=chart(document.querySelector("#hist-chart-main")),u=document.querySelector("#hist-filter-parking"),s=document.querySelector("#hist-filter-period"),d=document.querySelector("#hist-filter-datetime"),f=[];function e(t){(f=t.estacionamentos).map(function(t){return t.name}).forEach(function(t){var e=document.createElement("option");e.text=t,u.add(e)}),h("Dia",0,(new Date).getTime()),document.querySelector("#hist-filter-trigger").addEventListener("click",a),window.onresize=function(){o.redrawChart()}}function h(t,e,a){var r=!0;switch(t.toUpperCase()){case"HORA":n.getDataByHour(e,a,o.drawHourChart(a));break;case"DIA":n.getDataByDay(e,a,o.drawDayChart(a));break;case"SEMANA":n.getDataByWeek(e,a,o.drawWeekChart(a));break;case"MÊS":n.getDataByMonth(e,a,o.drawMonthChart(a));break;case"ANO":o.drawYearChart(a)(123);break;default:r=!1}return r}function a(t){var e,a,r=(e=u.value,void 0===(a=f.find(function(t){return t.name===e}))?-1:a.id);if(-1===r)return alert("Estacionamento inválido!");var n,o,i,l,c=(n=d.value,o=n.split(" "),i=o[0].split("/"),l=o[1],i[2]+"-"+i[1]+"-"+i[0]+"T"+l+":00.000");return function(t){if(!t.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}$/))return!1;var e=new Date(t);return!Number.isNaN(e.getTime())}(c)?h(s.value,r,new Date(c).getTime())?void $("#hist-filter-modal").modal("hide"):alert("Período inválido!"):alert("Data inválida!")}google.charts.load("current",{packages:["corechart"],language:"pt"}),google.charts.setOnLoadCallback(function(t){return n.getParkings(e)})}();