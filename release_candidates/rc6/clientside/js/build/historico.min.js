"use strict";var SPMRequest;!function(){var a=void 0;jQuery.datetimepicker.setLocale("pt"),jQuery("#hist-filter-datetime").datetimepicker({value:new Date,format:"d/m/Y",closeOnDateSelect:!0,mask:!0,timepicker:!1,id:"hist-filter-calendar",onGenerate:function(t,e){if(window.innerWidth<992){var a=document.querySelector("#hist-filter-calendar");a.style.left=window.innerWidth/2-a.offsetWidth/2+"px",a.style.top=window.innerHeight/2-a.offsetHeight/2+"px",a.style.bottom=""}},onClose:function(t,e){a=t}}),jQuery("#hist-filter-datetime-icon").click(function(){jQuery("#hist-filter-datetime").datetimepicker("show")}),jQuery("#hist-filter-period").change(function(){"Hora"===document.querySelector("#hist-filter-period").value?jQuery("#hist-filter-datetime").datetimepicker({value:a,format:"d/m/Y H:00",closeOnDateSelect:!1,mask:!0,timepicker:!0,id:"hist-filter-calendar"}):jQuery("#hist-filter-datetime").datetimepicker({value:a,format:"d/m/Y",closeOnDateSelect:!0,mask:!0,timepicker:!1,id:"hist-filter-calendar"})})}(),function(){var i="http://localhost:8080/v1/parkings",t=void 0;SPMRequest=function(){if(t)return t;function r(t,e){var a=new XMLHttpRequest;if(window.XMLHttpRequest)new XMLHttpRequest;else new ActiveXObject("Microsoft.XMLHTTP");a.open("GET",t,!0),a.onreadystatechange=function(){if(4==this.readyState){if(!(200<=this.status&&this.status<400))throw new Error(this.error);e(this.responseText)}},a.onerror=function(){throw new Error(this.error)},a.send()}return(t=this).getParkings=function(e){r(i,function(t){return e(JSON.parse(t))})},this.getDataByHour=function(t,e,a){r(i+"/"+t+"/findByHour?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByDay=function(t,e,a){r(i+"/"+t+"/findByDay?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByWeek=function(t,e,a){r(i+"/"+t+"/findByWeek?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByMonth=function(t,e,a){r(i+"/"+t+"/findByMonth?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByYear=function(t,e,a){r(i+"/"+t+"/findByYear?timestamp="+e,function(t){return a(JSON.parse(t))})},t}}();var chart=function(n){var o=void 0,l={},c={},u=[],s={},d=function(){google.visualization.events.addListener(o,"select",function(){var t=o.getSelection();if(0<t.length&&null===t[0].row){var e=t[0].column;u[e]==e?(u[e]={label:l.getColumnLabel(e),type:l.getColumnType(e),calc:function(){return null}},s[e-1].color="#cccccc"):(u[e]=e,s[e-1].color=null);var a=new google.visualization.DataView(l);a.setColumns(u),o.draw(a,c)}})};return{drawHourChart:function(t){for(var e=[["Minuto","Entrada","Saída","Fluxo"]],a=0;a<t.entrance.length;a++)e.push([t.entrance[a].period,t.entrance[a].value,t.exit[a].value,t.entrance[a].value-t.exit[a].value]);l=google.visualization.arrayToDataTable(e),s={0:{},1:{},2:{type:"line"}},u=[];for(var r=0;r<l.getNumberOfColumns();r++)u.push(r);var i=new Date(t.timestampFrom).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});c={title:"Hora - "+i.replace(/:/,"h"),titleTextStyle:{fontSize:16,color:"#053061"},seriesType:"bars",tooltip:{trigger:"selection"},aggregationTarget:"category",series:s,colors:["#fcde9c","#a7cfff","#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},o=new google.visualization.ComboChart(n),o.draw(l,c),d()},drawDayChart:function(t){for(var e=[["Horário do dia","Entrada","Saída","Fluxo"]],a=0;a<t.entrance.length;a++)e.push([t.entrance[a].period,t.entrance[a].value,t.exit[a].value,t.entrance[a].value-t.exit[a].value]);l=google.visualization.arrayToDataTable(e),s={0:{},1:{},2:{type:"line"}},u=[];for(var r=0;r<l.getNumberOfColumns();r++)u.push(r);var i=new Date(t.timestampFrom).toLocaleDateString("pt-BR");c={title:"Dia - "+i,titleTextStyle:{fontSize:16,color:"#053061"},seriesType:"bars",tooltip:{trigger:"selection"},aggregationTarget:"category",series:s,colors:["#fcde9c","#a7cfff","#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},o=new google.visualization.ComboChart(n),o.draw(l,c),d()},drawWeekChart:function(t){var e=[["Dias da semana","Entrada"]];t.entrance.forEach(function(t){return e.push([t.period,t.value])}),l=google.visualization.arrayToDataTable(e);var a=new Date(t.timestampFrom).toLocaleDateString("pt-BR"),r=new Date(t.timestampTo).toLocaleDateString("pt-BR");c={title:"Semana - "+a+" à "+r,titleTextStyle:{fontSize:16,color:"#053061"},colors:["#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{minValue:0,format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"}},o=new google.visualization.ColumnChart(n),o.draw(l,c)},drawMonthChart:function(t){var e=[["Dias do mês","Entrada"]];t.entrance.forEach(function(t){return e.push([t.period,t.value])}),l=google.visualization.arrayToDataTable(e);var a=new Date(t.timestampFrom).toLocaleDateString("pt-BR"),r=new Date(t.timestampTo).toLocaleDateString("pt-BR");c={title:"Mês - "+a+" à "+r,titleTextStyle:{fontSize:16,color:"#053061"},colors:["#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{minValue:0,format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"}},o=new google.visualization.ColumnChart(n),o.draw(l,c)},drawYearChart:function(t){var e=[["Meses do ano","Entrada"]];t.entrance.forEach(function(t){return e.push([t.period,t.value])}),l=google.visualization.arrayToDataTable(e);var a=new Date(t.timestampFrom).toLocaleDateString("pt-BR",{month:"2-digit",year:"numeric"}),r=new Date(t.timestampTo).toLocaleDateString("pt-BR",{month:"2-digit",year:"numeric"});c={title:"Ano - "+a+" à "+r,titleTextStyle:{fontSize:16,color:"#053061"},colors:["#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"#",gridline:{count:-1},textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},o=new google.visualization.LineChart(n),o.draw(l,c)},redrawChart:function(){o.draw(l,c)}}};!function(){var i=new SPMRequest,n=chart(document.querySelector("#hist-chart-main")),s=document.querySelector("#hist-filter-parking"),d=document.querySelector("#hist-filter-period"),f=document.querySelector("#hist-filter-datetime"),h=[];function t(t){if((h=t.parkings).map(function(t){return t.name}).forEach(function(t){var e=document.createElement("option");e.text=t,s.add(e)}),!m("Dia",0,(new Date).getTime()))return alert("Período inválido!");document.querySelector("#hist-filter-trigger").addEventListener("click",e),window.onresize=function(){n.redrawChart()}}function m(t,e,a){var r=!0;switch(t.toUpperCase()){case"HORA":i.getDataByHour(e,a,n.drawHourChart);break;case"DIA":i.getDataByDay(e,a,n.drawDayChart);break;case"SEMANA":i.getDataByWeek(e,a,n.drawWeekChart);break;case"MÊS":i.getDataByMonth(e,a,n.drawMonthChart);break;case"ANO":i.getDataByYear(e,a,n.drawYearChart);break;default:r=!1}return r}function e(t){var e,a,r=(e=s.value,void 0!==(a=h.find(function(t){return t.name===e}))?a.id:-1);if(-1===r)return alert("Estacionamento inválido!");var i,n,o,l,c=(i=f.value,n=i.split(/\ /),o=n[0].split(/\//),l=void 0!==n[1]?n[1]:"",o[2]+"-"+o[1]+"-"+o[0]+" "+l);if(!function(t){if(!t.match(/^\d{4}-\d{2}-\d{2}\ (\d{2}:\d{2})?$/))return!1;var e=new Date(t);if(Number.isNaN(e.getTime()))return!1;return!0}(c))return alert("Data inválida!");var u=new Date(c).getTime();if(!m(d.value,r,u))return alert("Período inválido!");$("#hist-filter-modal").modal("hide")}google.charts.load("current",{packages:["corechart"],language:"pt"}),google.charts.setOnLoadCallback(function(){return i.getParkings(t)})}();