"use strict";var SPMRequest;jQuery.datetimepicker.setLocale("pt"),jQuery("#hist-filter-datetime").datetimepicker({value:new Date,format:"d/m/Y H:00",closeOnDateSelect:!0,mask:!0}),jQuery("#hist-filter-datetime-icon").click(function(){jQuery("#hist-filter-datetime").datetimepicker("show")}),function(){var o="http://192.168.15.16:8080/v1/estacionamentos/",t=void 0;SPMRequest=function(){if(t)return t;function r(t,e){var a=new XMLHttpRequest;if(window.XMLHttpRequest)new XMLHttpRequest;else new ActiveXObject("Microsoft.XMLHTTP");a.open("GET",t,!0),a.onreadystatechange=function(){if(4==this.readyState){if(!(200<=this.status&&this.status<400))throw new Error(this.error);e(this.responseText)}},a.onerror=function(){throw new Error(this.error)},a.send()}return(t=this).getParkings=function(e){r(o,function(t){return e(JSON.parse(t))})},this.getDataByHour=function(t,e,a){r(o+t+"/findByHour?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByDay=function(t,e,a){r(o+t+"/findByDay?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByWeek=function(t,e,a){r(o+t+"/findByWeek?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByMonth=function(t,e,a){r(o+t+"/findByMonth?timestamp="+e,function(t){return a(JSON.parse(t))})},this.getDataByYear=function(t,e,a){r(o+t+"/findByYear?timestamp="+e,function(t){return a(JSON.parse(t))})},t}}();var chart=function(c){var u=void 0,l={},s={},o=[],n={},i=function(){google.visualization.events.addListener(u,"select",function(){var t=u.getSelection();if(0<t.length&&null===t[0].row){var e=t[0].column;o[e]==e?(o[e]={label:l.getColumnLabel(e),type:l.getColumnType(e),calc:function(){return null}},n[e-1].color="#cccccc"):(o[e]=e,n[e-1].color=null);var a=new google.visualization.DataView(l);a.setColumns(o),u.draw(a,s)}})};return{drawHourChart:function(t){for(var e=[["Minuto","Entrada","Saída","Fluxo"]],a=0;a<t.entrada.length;a++)e.push([5*(a+1)+"m",t.entrada[a],t.saida[a],Math.floor(Math.random()*t.entrada[a])-Math.floor(Math.random()*t.saida[a])]);l=google.visualization.arrayToDataTable(e),n={0:{},1:{},2:{type:"line"}},o=[];for(var r=0;r<l.getNumberOfColumns();r++)o.push(r);s={seriesType:"bars",tooltip:{trigger:"selection"},aggregationTarget:"category",series:n,colors:["#97cfff","#ffec97","#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"decimal",textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},u=new google.visualization.ComboChart(c),u.draw(l,s),i()},drawDayChart:function(t){for(var e=[["Horário do dia","Entrada","Saída","Fluxo"]],a=0;a<t.entrada.length;a++)e.push([a+1+"h",t.entrada[a],t.saida[a],Math.floor(Math.random()*t.entrada[a])-Math.floor(Math.random()*t.saida[a])]);l=google.visualization.arrayToDataTable(e),n={0:{},1:{},2:{type:"line"}},o=[];for(var r=0;r<l.getNumberOfColumns();r++)o.push(r);s={seriesType:"bars",tooltip:{trigger:"selection"},aggregationTarget:"category",series:n,colors:["#97cfff","#ffec97","#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"decimal",textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},u=new google.visualization.ComboChart(c),u.draw(l,s),i()},drawWeekChart:function(o){return function(t){var e=[["Dias da semana","Entrada"]],a=void 0;for(var r in t)a=new Date(o).toISOString().slice(5,10).split("-"),e.push([a[1]+"/"+a[0],t[r].entrada.reduce(function(t,e){return t+e})]),o+=864e5;l=google.visualization.arrayToDataTable(e),s={colors:["#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"decimal",textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"}},u=new google.visualization.ColumnChart(c),u.draw(l,s)}},drawMonthChart:function(i){return function(t){var e=[["Dias do mês","Entrada"]],a=0,r=void 0;for(var o in t)for(var n in t[o])a%7==0?(r=new Date(i).toISOString().slice(5,10).split("-"),e.push([r[1]+"/"+r[0],t[o][n].entrada.reduce(function(t,e){return t+e})]),i+=6048e5):e.push([n.slice(0,1).toUpperCase(),t[o][n].entrada.reduce(function(t,e){return t+e})]),a++;l=google.visualization.arrayToDataTable(e),s={colors:["#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"decimal",textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"}},u=new google.visualization.ColumnChart(c),u.draw(l,s)}},drawYearChart:function(t){l=new google.visualization.arrayToDataTable([["Meses do ano","Entrada"],["Jan",3e3],["Fev",3200],["Mar",2900],["Abr",3100],["Mai",2800],["Jun",1500],["Jul",500],["Ago",1500],["Set",1500],["Out",1500],["Nov",1500],["Dez",1500]]),s={colors:["#004684"],hAxis:{maxAlternation:1,textStyle:{fontSize:12,color:"#053061"}},vAxis:{format:"decimal",textStyle:{fontSize:14,color:"#053061"}},chartArea:{width:"75%",height:"80%"},curveType:"function",pointSize:7},u=new google.visualization.LineChart(c),u.draw(l,s)},redrawChart:function(){u.draw(l,s)}}};!function(){var o=new SPMRequest,n=chart(document.querySelector("#hist-chart-main")),l=document.querySelector("#hist-filter-parking"),s=document.querySelector("#hist-filter-period"),d=document.querySelector("#hist-filter-datetime"),f=[];function e(t){(f=t.estacionamentos).map(function(t){return t.name}).forEach(function(t){var e=document.createElement("option");e.text=t,l.add(e)}),h("Dia",0,(new Date).getTime()),document.querySelector("#hist-filter-trigger").addEventListener("click",a),window.onresize=function(){n.redrawChart()}}function h(t,e,a){var r=!0;switch(t.toUpperCase()){case"HORA":o.getDataByHour(e,a,n.drawHourChart);break;case"DIA":o.getDataByDay(e,a,n.drawDayChart);break;case"SEMANA":o.getDataByWeek(e,a,n.drawWeekChart(a));break;case"MÊS":o.getDataByMonth(e,a,n.drawMonthChart(a));break;case"ANO":n.drawYearChart(123);break;default:r=!1}return r}function a(t){var e,a,r=(e=l.value,void 0===(a=f.find(function(t){return t.name===e}))?-1:a.id);if(-1===r)return alert("Estacionamento inválido!");var o,n,i,c,u=(o=d.value,n=o.split(" "),i=n[0].split("/"),c=n[1],i[2]+"-"+i[1]+"-"+i[0]+" "+c);return function(t){if(!t.match(/^\d{4}-\d{2}-\d{2}\ \d{2}:\d{2}$/))return!1;var e=new Date(t);return!Number.isNaN(e.getTime())}(u)?h(s.value,r,new Date(u).getTime())?void $("#hist-filter-modal").modal("hide"):alert("Período inválido!"):alert("Data inválida!")}google.charts.load("current",{packages:["corechart"],language:"pt"}),google.charts.setOnLoadCallback(function(t){return o.getParkings(e)})}();